# ACL自主トレーニングアプリ - Renderデプロイメントガイド

## 概要
このガイドでは、ACL自主トレーニングアプリをRenderにデプロイする手順を説明します。

## 前提条件
- Renderアカウント（https://render.com でサインアップ）
- GitHubリポジトリにコードがプッシュされていること
- Node.js 18+ がローカルで動作すること

## デプロイ手順

### 1. Renderアカウントの準備
1. https://render.com にアクセス
2. GitHubアカウントでサインアップ/ログイン
3. GitHubリポジトリへのアクセス権限を許可

### 2. 自動デプロイ（推奨）
#### render.yamlを使用したデプロイ
1. リポジトリのルートディレクトリに `render.yaml` ファイルが含まれていることを確認
2. Renderダッシュボードで「New +」→「Blueprint」を選択
3. GitHubリポジトリを選択
4. `render.yaml` が自動検出され、設定が適用される
5. 「Create New Services」をクリック

### 3. 手動デプロイ
#### Web Serviceの作成
1. Renderダッシュボードで「New +」→「Web Service」を選択
2. GitHubリポジトリを選択
3. 以下の設定を入力：
   - **Name**: `acl-rehab-app`
   - **Environment**: `Node`
   - **Region**: `Oregon (US West)`
   - **Branch**: `main` (または適切なブランチ)
   - **Build Command**: `npm ci`
   - **Start Command**: `npm start`

#### 環境変数の設定
「Environment」タブで以下の環境変数を設定：
```
NODE_ENV=production
PORT=10000
FILE_RETENTION_HOURS=24
ANALYSIS_RETENTION_DAYS=7
MAX_FILE_SIZE=104857600
```

#### ディスクストレージの設定
「Settings」タブで以下を設定：
- **Disk Name**: `uploads`
- **Mount Path**: `/app/uploads`
- **Size**: `1 GB`

### 4. デプロイの確認
1. デプロイが完了したら、提供されたURLにアクセス
2. ヘルスチェックエンドポイント `https://your-app.onrender.com/health` で動作確認
3. ルートエンドポイント `https://your-app.onrender.com/` でアプリ情報を確認

## 環境変数詳細

| 変数名 | 説明 | デフォルト値 | 必須 |
|--------|------|-------------|------|
| `NODE_ENV` | 実行環境 | `production` | はい |
| `PORT` | ポート番号（Render側で自動設定） | `10000` | はい |
| `FILE_RETENTION_HOURS` | アップロード動画の保持時間 | `24` | いいえ |
| `ANALYSIS_RETENTION_DAYS` | 分析結果の保持日数 | `7` | いいえ |
| `MAX_FILE_SIZE` | 最大ファイルサイズ（バイト） | `104857600` | いいえ |

## ドメインとSSL
- Renderは自動的にSSL証明書を提供
- カスタムドメインを使用する場合は「Custom Domains」で設定
- 自動的にHTTPS化される

## 監視とログ
### ヘルスチェック
- Renderは自動的に `/health` エンドポイントを監視
- 応答しない場合は自動的にサービスを再起動

### ログの確認
1. Renderダッシュボードの「Logs」タブでリアルタイムログを確認
2. アプリケーションログ、ビルドログ、システムログが表示される

### メトリクス
「Metrics」タブで以下を監視：
- CPU使用率
- メモリ使用量
- 応答時間
- エラー率

## トラブルシューティング

### よくある問題と解決方法

#### 1. デプロイが失敗する
```bash
# package.jsonのエンジンバージョンを確認
"engines": {
  "node": ">=18.0.0",
  "npm": ">=8.0.0"
}
```

#### 2. ファイルアップロードが失敗する
- ディスクストレージが正しく設定されているか確認
- `/app/uploads` にマウントされているか確認

#### 3. 環境変数が読み込まれない
- Renderダッシュボードで環境変数が正しく設定されているか確認
- `dotenv` パッケージが正しく実装されているか確認

#### 4. ヘルスチェックが失敗する
- `/health` エンドポイントが正しく実装されているか確認
- ポート10000でリッスンしているか確認

#### 5. 静的ファイルが見つからない
- ビルドプロセスで静的ファイルが正しく生成されているか確認
- パスが正しく設定されているか確認

## コスト管理
- **Starter Plan**: 月額$7（750時間まで無料）
- **Standard Plan**: 月額$25（高性能、より多くのリソース）
- 使用量に応じて自動的にスケール

## セキュリティ
- 自動SSL証明書
- DDoS保護
- セキュリティヘッダー（Helmet.js実装済み）
- 定期的なセキュリティアップデート

## バックアップ
- Renderは自動的にサービスのスナップショットを作成
- ディスクデータは定期的にバックアップされる
- 必要に応じて手動でデータをダウンロード可能

## 次のステップ
1. QRコードにRenderのURLを設定
2. カスタムドメインの設定（オプション）
3. 監視アラートの設定
4. ログ監視の実装

## サポート
- Render公式ドキュメント: https://render.com/docs
- コミュニティフォーラム: https://community.render.com
- 技術的な問題は開発チームまでお問い合わせください

## 料金プラン比較

| プラン | 月額料金 | CPU | メモリ | 帯域幅 | ディスク |
|--------|----------|-----|--------|--------|----------|
| Free | $0 | 共有 | 512MB | 100GB | 一時的 |
| Starter | $7 | 共有 | 512MB | 100GB | 1GB永続 |
| Standard | $25 | 1vCPU | 2GB | 100GB | 10GB永続 |

推奨: 本番環境にはStarterプラン以上を使用