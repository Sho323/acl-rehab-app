{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport * as tf from '@tensorflow/tfjs';\nimport '@tensorflow/tfjs-react-native';\nvar AIAnalysisService = function () {\n  function AIAnalysisService() {\n    _classCallCheck(this, AIAnalysisService);\n    this.model = null;\n    this.isInitialized = false;\n    this.analysisResults = [];\n  }\n  return _createClass(AIAnalysisService, [{\n    key: \"initializeModel\",\n    value: function () {\n      var _initializeModel = _asyncToGenerator(function* () {\n        try {\n          __DEV__ && console.log('AI分析モデルを初期化中...');\n          yield tf.ready();\n          this.model = yield this.createDummyModel();\n          this.isInitialized = true;\n          __DEV__ && console.log('AI分析モデルの初期化が完了しました');\n          return true;\n        } catch (error) {\n          __DEV__ && console.error('AI分析モデルの初期化に失敗:', error);\n          return false;\n        }\n      });\n      function initializeModel() {\n        return _initializeModel.apply(this, arguments);\n      }\n      return initializeModel;\n    }()\n  }, {\n    key: \"createDummyModel\",\n    value: function () {\n      var _createDummyModel = _asyncToGenerator(function* () {\n        var model = tf.sequential({\n          layers: [tf.layers.dense({\n            inputShape: [68],\n            units: 128,\n            activation: 'relu'\n          }), tf.layers.dropout({\n            rate: 0.2\n          }), tf.layers.dense({\n            units: 64,\n            activation: 'relu'\n          }), tf.layers.dense({\n            units: 32,\n            activation: 'relu'\n          }), tf.layers.dense({\n            units: 1,\n            activation: 'sigmoid'\n          })]\n        });\n        model.compile({\n          optimizer: 'adam',\n          loss: 'binaryCrossentropy',\n          metrics: ['accuracy']\n        });\n        return model;\n      });\n      function createDummyModel() {\n        return _createDummyModel.apply(this, arguments);\n      }\n      return createDummyModel;\n    }()\n  }, {\n    key: \"analyzeFrame\",\n    value: function () {\n      var _analyzeFrame = _asyncToGenerator(function* (keypoints) {\n        var exerciseType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'squat';\n        if (!this.isInitialized || !this.model) {\n          return this.getDummyAnalysisResult(exerciseType);\n        }\n        try {\n          var normalizedKeypoints = this.preprocessKeypoints(keypoints);\n          var inputTensor = tf.tensor2d([normalizedKeypoints], [1, 68]);\n          var prediction = yield this.model.predict(inputTensor);\n          var score = yield prediction.data();\n          inputTensor.dispose();\n          prediction.dispose();\n          var analysisResult = this.interpretResults(score[0], exerciseType, keypoints);\n          this.analysisResults.push(_objectSpread({\n            timestamp: Date.now(),\n            exerciseType: exerciseType\n          }, analysisResult));\n          return analysisResult;\n        } catch (error) {\n          __DEV__ && console.error('フレーム分析エラー:', error);\n          return this.getDummyAnalysisResult(exerciseType);\n        }\n      });\n      function analyzeFrame(_x) {\n        return _analyzeFrame.apply(this, arguments);\n      }\n      return analyzeFrame;\n    }()\n  }, {\n    key: \"preprocessKeypoints\",\n    value: function preprocessKeypoints(keypoints) {\n      if (!keypoints || keypoints.length === 0) {\n        return new Array(68).fill(0);\n      }\n      var normalized = [];\n      var keyJoints = [0, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22];\n      var leftHip = keypoints[11] || {\n        x: 0,\n        y: 0\n      };\n      var rightHip = keypoints[12] || {\n        x: 0,\n        y: 0\n      };\n      var hipCenter = {\n        x: (leftHip.x + rightHip.x) / 2,\n        y: (leftHip.y + rightHip.y) / 2\n      };\n      for (var i = 0; i < 34; i++) {\n        var keypoint = keypoints[i];\n        if (keypoint && keypoint.score > 0.5) {\n          normalized.push((keypoint.x - hipCenter.x) / 100);\n          normalized.push((keypoint.y - hipCenter.y) / 100);\n        } else {\n          normalized.push(0);\n          normalized.push(0);\n        }\n      }\n      return normalized;\n    }\n  }, {\n    key: \"interpretResults\",\n    value: function interpretResults(score, exerciseType, keypoints) {\n      var kneeInToeOutScore = score;\n      var detailedAnalysis = this.analyzeKneeAlignment(keypoints);\n      var overallScore = this.calculateOverallScore(kneeInToeOutScore, detailedAnalysis);\n      var feedback = this.generateFeedback(overallScore, detailedAnalysis, exerciseType);\n      return {\n        kneeInToeOutScore: Math.round(kneeInToeOutScore * 100),\n        overallScore: Math.round(overallScore * 100),\n        alignment: detailedAnalysis,\n        feedback: feedback,\n        timestamp: Date.now(),\n        exerciseType: exerciseType\n      };\n    }\n  }, {\n    key: \"analyzeKneeAlignment\",\n    value: function analyzeKneeAlignment(keypoints) {\n      if (!keypoints || keypoints.length < 23) {\n        return {\n          leftKneeAlignment: 'unknown',\n          rightKneeAlignment: 'unknown',\n          kneeWidth: 0,\n          ankleWidth: 0,\n          kneeAnkleRatio: 1\n        };\n      }\n      var leftKnee = keypoints[13];\n      var rightKnee = keypoints[14];\n      var leftAnkle = keypoints[15];\n      var rightAnkle = keypoints[16];\n      if (!leftKnee || !rightKnee || !leftAnkle || !rightAnkle) {\n        return {\n          leftKneeAlignment: 'unknown',\n          rightKneeAlignment: 'unknown',\n          kneeWidth: 0,\n          ankleWidth: 0,\n          kneeAnkleRatio: 1\n        };\n      }\n      var kneeWidth = Math.abs(rightKnee.x - leftKnee.x);\n      var ankleWidth = Math.abs(rightAnkle.x - leftAnkle.x);\n      var kneeAnkleRatio = kneeWidth / ankleWidth;\n      var leftKneeAlignment = this.evaluateKneePosition(leftKnee, leftAnkle, 'left');\n      var rightKneeAlignment = this.evaluateKneePosition(rightKnee, rightAnkle, 'right');\n      return {\n        leftKneeAlignment: leftKneeAlignment,\n        rightKneeAlignment: rightKneeAlignment,\n        kneeWidth: kneeWidth,\n        ankleWidth: ankleWidth,\n        kneeAnkleRatio: Math.round(kneeAnkleRatio * 100) / 100\n      };\n    }\n  }, {\n    key: \"evaluateKneePosition\",\n    value: function evaluateKneePosition(knee, ankle, side) {\n      if (!knee || !ankle) return 'unknown';\n      var horizontalDiff = Math.abs(knee.x - ankle.x);\n      var threshold = 20;\n      if (horizontalDiff < threshold) {\n        return 'good';\n      } else if (horizontalDiff < threshold * 2) {\n        return 'moderate';\n      } else {\n        return 'poor';\n      }\n    }\n  }, {\n    key: \"calculateOverallScore\",\n    value: function calculateOverallScore(kneeInToeOutScore, alignment) {\n      var score = (1 - kneeInToeOutScore) * 0.6;\n      var leftAlignmentScore = this.getAlignmentScore(alignment.leftKneeAlignment);\n      var rightAlignmentScore = this.getAlignmentScore(alignment.rightKneeAlignment);\n      var alignmentScore = (leftAlignmentScore + rightAlignmentScore) / 2;\n      score += alignmentScore * 0.3;\n      var ratioScore = this.getRatioScore(alignment.kneeAnkleRatio);\n      score += ratioScore * 0.1;\n      return Math.max(0, Math.min(1, score));\n    }\n  }, {\n    key: \"getAlignmentScore\",\n    value: function getAlignmentScore(alignment) {\n      switch (alignment) {\n        case 'good':\n          return 1.0;\n        case 'moderate':\n          return 0.6;\n        case 'poor':\n          return 0.2;\n        default:\n          return 0.5;\n      }\n    }\n  }, {\n    key: \"getRatioScore\",\n    value: function getRatioScore(ratio) {\n      if (ratio >= 0.8 && ratio <= 1.2) return 1.0;\n      if (ratio >= 0.6 && ratio <= 1.4) return 0.7;\n      return 0.3;\n    }\n  }, {\n    key: \"generateFeedback\",\n    value: function generateFeedback(overallScore, alignment, exerciseType) {\n      var feedback = {\n        level: 'good',\n        message: '',\n        suggestions: []\n      };\n      if (overallScore >= 0.8) {\n        feedback.level = 'good';\n        feedback.message = '素晴らしいフォームです！この調子で続けましょう。';\n        feedback.suggestions = ['現在のフォームを維持してください'];\n      } else if (overallScore >= 0.6) {\n        feedback.level = 'moderate';\n        feedback.message = '概ね良好ですが、改善の余地があります。';\n        feedback.suggestions = this.getModerateAdvice(alignment, exerciseType);\n      } else {\n        feedback.level = 'poor';\n        feedback.message = 'フォームに問題があります。安全のため注意してください。';\n        feedback.suggestions = this.getPoorAdvice(alignment, exerciseType);\n      }\n      return feedback;\n    }\n  }, {\n    key: \"getModerateAdvice\",\n    value: function getModerateAdvice(alignment, exerciseType) {\n      var advice = [];\n      if (alignment.kneeAnkleRatio > 1.2) {\n        advice.push('膝が外側に開きすぎています。つま先の方向を意識しましょう');\n      } else if (alignment.kneeAnkleRatio < 0.8) {\n        advice.push('膝が内側に入りすぎています。膝をつま先の方向に向けましょう');\n      }\n      if (alignment.leftKneeAlignment === 'moderate' || alignment.rightKneeAlignment === 'moderate') {\n        advice.push('膝の位置をつま先の真上に保ちましょう');\n      }\n      if (exerciseType === 'squat') {\n        advice.push('スクワット時は膝とつま先を同じ向きにしてください');\n      }\n      return advice.length > 0 ? advice : ['フォームを少し調整してみましょう'];\n    }\n  }, {\n    key: \"getPoorAdvice\",\n    value: function getPoorAdvice(alignment, exerciseType) {\n      var advice = [];\n      if (alignment.kneeAnkleRatio > 1.4) {\n        advice.push('膝が大きく外側に開いています。怪我の危険があります');\n        advice.push('つま先の向きと膝の向きを揃えてください');\n      } else if (alignment.kneeAnkleRatio < 0.6) {\n        advice.push('膝が内側に大きく入っています（knee-in）');\n        advice.push('膝をつま先の方向に向けて、股関節から動かしましょう');\n      }\n      if (alignment.leftKneeAlignment === 'poor') {\n        advice.push('左膝の位置を修正してください');\n      }\n      if (alignment.rightKneeAlignment === 'poor') {\n        advice.push('右膝の位置を修正してください');\n      }\n      advice.push('動作をゆっくり行い、正しいフォームを意識してください');\n      return advice;\n    }\n  }, {\n    key: \"getDummyAnalysisResult\",\n    value: function getDummyAnalysisResult(exerciseType) {\n      var scenarios = [{\n        kneeInToeOutScore: 15,\n        overallScore: 85,\n        alignment: {\n          leftKneeAlignment: 'good',\n          rightKneeAlignment: 'good',\n          kneeWidth: 45,\n          ankleWidth: 48,\n          kneeAnkleRatio: 0.94\n        },\n        feedback: {\n          level: 'good',\n          message: '素晴らしいフォームです！この調子で続けましょう。',\n          suggestions: ['現在のフォームを維持してください']\n        }\n      }, {\n        kneeInToeOutScore: 35,\n        overallScore: 65,\n        alignment: {\n          leftKneeAlignment: 'moderate',\n          rightKneeAlignment: 'good',\n          kneeWidth: 35,\n          ankleWidth: 45,\n          kneeAnkleRatio: 0.78\n        },\n        feedback: {\n          level: 'moderate',\n          message: '概ね良好ですが、改善の余地があります。',\n          suggestions: ['左膝の位置をつま先の真上に保ちましょう', '膝が内側に入りすぎています。膝をつま先の方向に向けましょう']\n        }\n      }, {\n        kneeInToeOutScore: 60,\n        overallScore: 40,\n        alignment: {\n          leftKneeAlignment: 'poor',\n          rightKneeAlignment: 'moderate',\n          kneeWidth: 28,\n          ankleWidth: 48,\n          kneeAnkleRatio: 0.58\n        },\n        feedback: {\n          level: 'poor',\n          message: 'フォームに問題があります。安全のため注意してください。',\n          suggestions: ['膝が内側に大きく入っています（knee-in）', '膝をつま先の方向に向けて、股関節から動かしましょう', '左膝の位置を修正してください', '動作をゆっくり行い、正しいフォームを意識してください']\n        }\n      }];\n      var randomIndex = Math.floor(Math.random() * scenarios.length);\n      var result = scenarios[randomIndex];\n      return _objectSpread(_objectSpread({}, result), {}, {\n        timestamp: Date.now(),\n        exerciseType: exerciseType,\n        isDummy: true\n      });\n    }\n  }, {\n    key: \"getSessionSummary\",\n    value: function getSessionSummary() {\n      if (this.analysisResults.length === 0) {\n        return {\n          totalFrames: 0,\n          averageScore: 0,\n          issueCount: 0,\n          improvements: []\n        };\n      }\n      var totalFrames = this.analysisResults.length;\n      var averageScore = this.analysisResults.reduce(function (sum, result) {\n        return sum + result.overallScore;\n      }, 0) / totalFrames;\n      var issueCount = this.analysisResults.filter(function (result) {\n        return result.overallScore < 60;\n      }).length;\n      var improvements = this.generateSessionImprovements();\n      return {\n        totalFrames: totalFrames,\n        averageScore: Math.round(averageScore),\n        issueCount: issueCount,\n        improvements: improvements\n      };\n    }\n  }, {\n    key: \"generateSessionImprovements\",\n    value: function generateSessionImprovements() {\n      var improvements = [];\n      var poorResults = this.analysisResults.filter(function (result) {\n        return result.overallScore < 60;\n      });\n      if (poorResults.length > this.analysisResults.length * 0.3) {\n        improvements.push('フォームの基本を見直すことをお勧めします');\n      }\n      var kneeInIssues = this.analysisResults.filter(function (result) {\n        return result.kneeInToeOutScore > 50;\n      });\n      if (kneeInIssues.length > 0) {\n        improvements.push('膝が内側に入る傾向があります。股関節の動きを意識してください');\n      }\n      return improvements;\n    }\n  }, {\n    key: \"resetAnalysis\",\n    value: function resetAnalysis() {\n      this.analysisResults = [];\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      if (this.model) {\n        this.model.dispose();\n        this.model = null;\n      }\n      this.analysisResults = [];\n      this.isInitialized = false;\n    }\n  }]);\n}();\nvar aiAnalysisService = new AIAnalysisService();\nexport default aiAnalysisService;","map":{"version":3,"names":["tf","AIAnalysisService","_classCallCheck","model","isInitialized","analysisResults","_createClass","key","value","_initializeModel","_asyncToGenerator","__DEV__","console","log","ready","createDummyModel","error","initializeModel","apply","arguments","_createDummyModel","sequential","layers","dense","inputShape","units","activation","dropout","rate","compile","optimizer","loss","metrics","_analyzeFrame","keypoints","exerciseType","length","undefined","getDummyAnalysisResult","normalizedKeypoints","preprocessKeypoints","inputTensor","tensor2d","prediction","predict","score","data","dispose","analysisResult","interpretResults","push","_objectSpread","timestamp","Date","now","analyzeFrame","_x","Array","fill","normalized","keyJoints","leftHip","x","y","rightHip","hipCenter","i","keypoint","kneeInToeOutScore","detailedAnalysis","analyzeKneeAlignment","overallScore","calculateOverallScore","feedback","generateFeedback","Math","round","alignment","leftKneeAlignment","rightKneeAlignment","kneeWidth","ankleWidth","kneeAnkleRatio","leftKnee","rightKnee","leftAnkle","rightAnkle","abs","evaluateKneePosition","knee","ankle","side","horizontalDiff","threshold","leftAlignmentScore","getAlignmentScore","rightAlignmentScore","alignmentScore","ratioScore","getRatioScore","max","min","ratio","level","message","suggestions","getModerateAdvice","getPoorAdvice","advice","scenarios","randomIndex","floor","random","result","isDummy","getSessionSummary","totalFrames","averageScore","issueCount","improvements","reduce","sum","filter","generateSessionImprovements","poorResults","kneeInIssues","resetAnalysis","aiAnalysisService"],"sources":["/Users/shota/Desktop/文献検索/acl-rehab-app/mobile/src/services/aiAnalysis.js"],"sourcesContent":["import * as tf from '@tensorflow/tfjs';\nimport '@tensorflow/tfjs-react-native';\n\n// AI動作分析サービス\nclass AIAnalysisService {\n  constructor() {\n    this.model = null;\n    this.isInitialized = false;\n    this.analysisResults = [];\n  }\n\n  // モデル初期化\n  async initializeModel() {\n    try {\n      // 実際の環境では事前訓練されたモデルを読み込み\n      // この例ではダミーのモデル構造を示す\n      __DEV__ && console.log('AI分析モデルを初期化中...');\n      \n      // TensorFlow.js プラットフォーム設定\n      await tf.ready();\n      \n      // ダミーモデル（実際の実装では外部モデルファイルを読み込み）\n      this.model = await this.createDummyModel();\n      \n      this.isInitialized = true;\n      __DEV__ && console.log('AI分析モデルの初期化が完了しました');\n      \n      return true;\n    } catch (error) {\n      __DEV__ && console.error('AI分析モデルの初期化に失敗:', error);\n      return false;\n    }\n  }\n\n  // ダミーモデル作成（実際の実装では外部モデルを使用）\n  async createDummyModel() {\n    const model = tf.sequential({\n      layers: [\n        tf.layers.dense({ inputShape: [68], units: 128, activation: 'relu' }), // 34キーポイント × 2座標\n        tf.layers.dropout({ rate: 0.2 }),\n        tf.layers.dense({ units: 64, activation: 'relu' }),\n        tf.layers.dense({ units: 32, activation: 'relu' }),\n        tf.layers.dense({ units: 1, activation: 'sigmoid' }) // Knee-in-toe-out検出（0-1）\n      ]\n    });\n    \n    model.compile({\n      optimizer: 'adam',\n      loss: 'binaryCrossentropy',\n      metrics: ['accuracy']\n    });\n    \n    return model;\n  }\n\n  // フレーム分析\n  async analyzeFrame(keypoints, exerciseType = 'squat') {\n    if (!this.isInitialized || !this.model) {\n      return this.getDummyAnalysisResult(exerciseType);\n    }\n\n    try {\n      // キーポイント前処理\n      const normalizedKeypoints = this.preprocessKeypoints(keypoints);\n      \n      // テンソル作成\n      const inputTensor = tf.tensor2d([normalizedKeypoints], [1, 68]);\n      \n      // 推論実行\n      const prediction = await this.model.predict(inputTensor);\n      const score = await prediction.data();\n      \n      // リソース解放\n      inputTensor.dispose();\n      prediction.dispose();\n      \n      // 結果分析\n      const analysisResult = this.interpretResults(score[0], exerciseType, keypoints);\n      \n      // 結果履歴に追加\n      this.analysisResults.push({\n        timestamp: Date.now(),\n        exerciseType: exerciseType,\n        ...analysisResult\n      });\n      \n      return analysisResult;\n    } catch (error) {\n      __DEV__ && console.error('フレーム分析エラー:', error);\n      return this.getDummyAnalysisResult(exerciseType);\n    }\n  }\n\n  // キーポイント前処理\n  preprocessKeypoints(keypoints) {\n    if (!keypoints || keypoints.length === 0) {\n      return new Array(68).fill(0);\n    }\n\n    const normalized = [];\n    \n    // 主要な関節点のインデックス（COCO形式）\n    const keyJoints = [\n      0,  // nose\n      5,  // left_shoulder\n      6,  // right_shoulder\n      7,  // left_elbow\n      8,  // right_elbow\n      9,  // left_wrist\n      10, // right_wrist\n      11, // left_hip\n      12, // right_hip\n      13, // left_knee\n      14, // right_knee\n      15, // left_ankle\n      16, // right_ankle\n      17, // left_big_toe\n      18, // right_big_toe\n      19, // left_small_toe\n      20, // right_small_toe\n      21, // left_heel\n      22, // right_heel\n    ];\n\n    // 正規化：股関節の中点を基準とした相対座標\n    const leftHip = keypoints[11] || { x: 0, y: 0 };\n    const rightHip = keypoints[12] || { x: 0, y: 0 };\n    const hipCenter = {\n      x: (leftHip.x + rightHip.x) / 2,\n      y: (leftHip.y + rightHip.y) / 2\n    };\n\n    // 各関節の相対位置を計算\n    for (let i = 0; i < 34; i++) {\n      const keypoint = keypoints[i];\n      if (keypoint && keypoint.score > 0.5) {\n        normalized.push((keypoint.x - hipCenter.x) / 100); // X座標\n        normalized.push((keypoint.y - hipCenter.y) / 100); // Y座標\n      } else {\n        normalized.push(0);\n        normalized.push(0);\n      }\n    }\n\n    return normalized;\n  }\n\n  // 結果解釈\n  interpretResults(score, exerciseType, keypoints) {\n    const kneeInToeOutScore = score;\n    \n    // 膝とつま先の位置関係を詳細分析\n    const detailedAnalysis = this.analyzeKneeAlignment(keypoints);\n    \n    // 総合評価\n    const overallScore = this.calculateOverallScore(kneeInToeOutScore, detailedAnalysis);\n    \n    // フィードバック生成\n    const feedback = this.generateFeedback(overallScore, detailedAnalysis, exerciseType);\n    \n    return {\n      kneeInToeOutScore: Math.round(kneeInToeOutScore * 100),\n      overallScore: Math.round(overallScore * 100),\n      alignment: detailedAnalysis,\n      feedback: feedback,\n      timestamp: Date.now(),\n      exerciseType: exerciseType\n    };\n  }\n\n  // 膝の位置関係詳細分析\n  analyzeKneeAlignment(keypoints) {\n    if (!keypoints || keypoints.length < 23) {\n      return {\n        leftKneeAlignment: 'unknown',\n        rightKneeAlignment: 'unknown',\n        kneeWidth: 0,\n        ankleWidth: 0,\n        kneeAnkleRatio: 1\n      };\n    }\n\n    const leftKnee = keypoints[13];\n    const rightKnee = keypoints[14];\n    const leftAnkle = keypoints[15];\n    const rightAnkle = keypoints[16];\n\n    if (!leftKnee || !rightKnee || !leftAnkle || !rightAnkle) {\n      return {\n        leftKneeAlignment: 'unknown',\n        rightKneeAlignment: 'unknown',\n        kneeWidth: 0,\n        ankleWidth: 0,\n        kneeAnkleRatio: 1\n      };\n    }\n\n    // 膝と足首の幅を計算\n    const kneeWidth = Math.abs(rightKnee.x - leftKnee.x);\n    const ankleWidth = Math.abs(rightAnkle.x - leftAnkle.x);\n    const kneeAnkleRatio = kneeWidth / ankleWidth;\n\n    // 各膝の位置評価\n    const leftKneeAlignment = this.evaluateKneePosition(leftKnee, leftAnkle, 'left');\n    const rightKneeAlignment = this.evaluateKneePosition(rightKnee, rightAnkle, 'right');\n\n    return {\n      leftKneeAlignment,\n      rightKneeAlignment,\n      kneeWidth,\n      ankleWidth,\n      kneeAnkleRatio: Math.round(kneeAnkleRatio * 100) / 100\n    };\n  }\n\n  // 個別膝位置評価\n  evaluateKneePosition(knee, ankle, side) {\n    if (!knee || !ankle) return 'unknown';\n\n    const horizontalDiff = Math.abs(knee.x - ankle.x);\n    const threshold = 20; // ピクセル単位の閾値\n\n    if (horizontalDiff < threshold) {\n      return 'good';\n    } else if (horizontalDiff < threshold * 2) {\n      return 'moderate';\n    } else {\n      return 'poor';\n    }\n  }\n\n  // 総合スコア計算\n  calculateOverallScore(kneeInToeOutScore, alignment) {\n    let score = (1 - kneeInToeOutScore) * 0.6; // knee-in-toe-out問題がない場合は高スコア\n    \n    // 膝の位置関係を考慮\n    const leftAlignmentScore = this.getAlignmentScore(alignment.leftKneeAlignment);\n    const rightAlignmentScore = this.getAlignmentScore(alignment.rightKneeAlignment);\n    const alignmentScore = (leftAlignmentScore + rightAlignmentScore) / 2;\n    \n    score += alignmentScore * 0.3;\n    \n    // 膝と足首の幅比率を考慮\n    const ratioScore = this.getRatioScore(alignment.kneeAnkleRatio);\n    score += ratioScore * 0.1;\n    \n    return Math.max(0, Math.min(1, score));\n  }\n\n  // 位置関係スコア\n  getAlignmentScore(alignment) {\n    switch (alignment) {\n      case 'good': return 1.0;\n      case 'moderate': return 0.6;\n      case 'poor': return 0.2;\n      default: return 0.5;\n    }\n  }\n\n  // 比率スコア\n  getRatioScore(ratio) {\n    // 理想的な比率は0.8-1.2\n    if (ratio >= 0.8 && ratio <= 1.2) return 1.0;\n    if (ratio >= 0.6 && ratio <= 1.4) return 0.7;\n    return 0.3;\n  }\n\n  // フィードバック生成\n  generateFeedback(overallScore, alignment, exerciseType) {\n    const feedback = {\n      level: 'good',\n      message: '',\n      suggestions: []\n    };\n\n    if (overallScore >= 0.8) {\n      feedback.level = 'good';\n      feedback.message = '素晴らしいフォームです！この調子で続けましょう。';\n      feedback.suggestions = ['現在のフォームを維持してください'];\n    } else if (overallScore >= 0.6) {\n      feedback.level = 'moderate';\n      feedback.message = '概ね良好ですが、改善の余地があります。';\n      feedback.suggestions = this.getModerateAdvice(alignment, exerciseType);\n    } else {\n      feedback.level = 'poor';\n      feedback.message = 'フォームに問題があります。安全のため注意してください。';\n      feedback.suggestions = this.getPoorAdvice(alignment, exerciseType);\n    }\n\n    return feedback;\n  }\n\n  // 中程度の問題に対するアドバイス\n  getModerateAdvice(alignment, exerciseType) {\n    const advice = [];\n    \n    if (alignment.kneeAnkleRatio > 1.2) {\n      advice.push('膝が外側に開きすぎています。つま先の方向を意識しましょう');\n    } else if (alignment.kneeAnkleRatio < 0.8) {\n      advice.push('膝が内側に入りすぎています。膝をつま先の方向に向けましょう');\n    }\n    \n    if (alignment.leftKneeAlignment === 'moderate' || alignment.rightKneeAlignment === 'moderate') {\n      advice.push('膝の位置をつま先の真上に保ちましょう');\n    }\n    \n    if (exerciseType === 'squat') {\n      advice.push('スクワット時は膝とつま先を同じ向きにしてください');\n    }\n    \n    return advice.length > 0 ? advice : ['フォームを少し調整してみましょう'];\n  }\n\n  // 問題のあるフォームに対するアドバイス\n  getPoorAdvice(alignment, exerciseType) {\n    const advice = [];\n    \n    if (alignment.kneeAnkleRatio > 1.4) {\n      advice.push('膝が大きく外側に開いています。怪我の危険があります');\n      advice.push('つま先の向きと膝の向きを揃えてください');\n    } else if (alignment.kneeAnkleRatio < 0.6) {\n      advice.push('膝が内側に大きく入っています（knee-in）');\n      advice.push('膝をつま先の方向に向けて、股関節から動かしましょう');\n    }\n    \n    if (alignment.leftKneeAlignment === 'poor') {\n      advice.push('左膝の位置を修正してください');\n    }\n    \n    if (alignment.rightKneeAlignment === 'poor') {\n      advice.push('右膝の位置を修正してください');\n    }\n    \n    advice.push('動作をゆっくり行い、正しいフォームを意識してください');\n    \n    return advice;\n  }\n\n  // ダミー分析結果（モデル未初期化時）\n  getDummyAnalysisResult(exerciseType) {\n    // リアルなダミーデータを生成\n    const scenarios = [\n      {\n        kneeInToeOutScore: 15,\n        overallScore: 85,\n        alignment: {\n          leftKneeAlignment: 'good',\n          rightKneeAlignment: 'good',\n          kneeWidth: 45,\n          ankleWidth: 48,\n          kneeAnkleRatio: 0.94\n        },\n        feedback: {\n          level: 'good',\n          message: '素晴らしいフォームです！この調子で続けましょう。',\n          suggestions: ['現在のフォームを維持してください']\n        }\n      },\n      {\n        kneeInToeOutScore: 35,\n        overallScore: 65,\n        alignment: {\n          leftKneeAlignment: 'moderate',\n          rightKneeAlignment: 'good',\n          kneeWidth: 35,\n          ankleWidth: 45,\n          kneeAnkleRatio: 0.78\n        },\n        feedback: {\n          level: 'moderate',\n          message: '概ね良好ですが、改善の余地があります。',\n          suggestions: [\n            '左膝の位置をつま先の真上に保ちましょう',\n            '膝が内側に入りすぎています。膝をつま先の方向に向けましょう'\n          ]\n        }\n      },\n      {\n        kneeInToeOutScore: 60,\n        overallScore: 40,\n        alignment: {\n          leftKneeAlignment: 'poor',\n          rightKneeAlignment: 'moderate',\n          kneeWidth: 28,\n          ankleWidth: 48,\n          kneeAnkleRatio: 0.58\n        },\n        feedback: {\n          level: 'poor',\n          message: 'フォームに問題があります。安全のため注意してください。',\n          suggestions: [\n            '膝が内側に大きく入っています（knee-in）',\n            '膝をつま先の方向に向けて、股関節から動かしましょう',\n            '左膝の位置を修正してください',\n            '動作をゆっくり行い、正しいフォームを意識してください'\n          ]\n        }\n      }\n    ];\n    \n    // ランダムにシナリオを選択\n    const randomIndex = Math.floor(Math.random() * scenarios.length);\n    const result = scenarios[randomIndex];\n    \n    return {\n      ...result,\n      timestamp: Date.now(),\n      exerciseType: exerciseType,\n      isDummy: true\n    };\n  }\n\n  // セッション分析サマリー\n  getSessionSummary() {\n    if (this.analysisResults.length === 0) {\n      return {\n        totalFrames: 0,\n        averageScore: 0,\n        issueCount: 0,\n        improvements: []\n      };\n    }\n\n    const totalFrames = this.analysisResults.length;\n    const averageScore = this.analysisResults.reduce((sum, result) => sum + result.overallScore, 0) / totalFrames;\n    const issueCount = this.analysisResults.filter(result => result.overallScore < 60).length;\n    \n    const improvements = this.generateSessionImprovements();\n    \n    return {\n      totalFrames,\n      averageScore: Math.round(averageScore),\n      issueCount,\n      improvements\n    };\n  }\n\n  // セッション改善提案\n  generateSessionImprovements() {\n    const improvements = [];\n    const poorResults = this.analysisResults.filter(result => result.overallScore < 60);\n    \n    if (poorResults.length > this.analysisResults.length * 0.3) {\n      improvements.push('フォームの基本を見直すことをお勧めします');\n    }\n    \n    const kneeInIssues = this.analysisResults.filter(result => result.kneeInToeOutScore > 50);\n    if (kneeInIssues.length > 0) {\n      improvements.push('膝が内側に入る傾向があります。股関節の動きを意識してください');\n    }\n    \n    return improvements;\n  }\n\n  // 分析結果リセット\n  resetAnalysis() {\n    this.analysisResults = [];\n  }\n\n  // リソース解放\n  dispose() {\n    if (this.model) {\n      this.model.dispose();\n      this.model = null;\n    }\n    this.analysisResults = [];\n    this.isInitialized = false;\n  }\n}\n\n// シングルトンインスタンス\nconst aiAnalysisService = new AIAnalysisService();\n\nexport default aiAnalysisService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}